<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background-color: lightblue;
      color: white;
    }
  </style>
</head>
<body>

  <h2>Upload Video</h2>
  <input type="file" id="video" name="video" accept="video/*">
  <button onclick="uploadVideo()">Upload</button>

  <video id="uploadedVideo" width="320" height="240" controls>
    <source id="videoSource">
  </video>

  <p id="predictionsContainer"></p>

  <script>
    const videoElement = document.querySelector('#uploadedVideo');
    const predictionsContainer = document.querySelector('#predictionsContainer');

    async function uploadVideo() {
      const fileInput = document.querySelector('#video');
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      videoElement.src = URL.createObjectURL(fileInput.files[0]);
      videoElement.load();

      videoElement.onloadeddata = async () => {
        // Send the video file to the back end for processing
        const response = await fetch('https://a25a-73-93-85-15.ngrok.io/video_results', {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();

        // Store the predictions in a map where the keys are the frame numbers
        const predictions = new Map(result.predictions.map(p => [p.frame, p.predicted_object]));

        // Start playing the video
        videoElement.play();

        // Update the displayed prediction for each frame
        videoElement.ontimeupdate = () => {
          const frame = Math.floor(videoElement.currentTime * videoElement.playbackRate);
          if (predictions.has(frame)) {
            predictionsContainer.textContent = `Frame ${frame}: ${predictions.get(frame)}`;
          }
        }
      }
    }
  </script>

</body>
</html>
